{"remainingRequest":"C:\\Users\\HP\\Desktop\\系统\\fontend\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\HP\\Desktop\\系统\\fontend\\src\\views\\index\\components\\Main.vue?vue&type=script&lang=js","dependencies":[{"path":"C:\\Users\\HP\\Desktop\\系统\\fontend\\src\\views\\index\\components\\Main.vue","mtime":1746971736000},{"path":"C:\\Users\\HP\\Desktop\\系统\\fontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\HP\\Desktop\\系统\\fontend\\node_modules\\babel-loader\\lib\\index.js","mtime":456789000000},{"path":"C:\\Users\\HP\\Desktop\\系统\\fontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\HP\\Desktop\\系统\\fontend\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7bWFwR2V0dGVyc30gZnJvbSAidnVleCI7CmltcG9ydCB7Z2V0SGlzdG9yeU1zZywgc2F2ZUFJTWVzc2FnZX0gZnJvbSAiQC9hcGkvY2hhdCI7CmltcG9ydCB7Z2V0VG9rZW4sIGdldFNpdGVDb2RlfSBmcm9tICJAL3V0aWxzL2F1dGgiOwppbXBvcnQgVGV4dENvbXBvbmVudCBmcm9tICIuL1RleHQiOwppbXBvcnQgV2VsY29tZSBmcm9tICIuL1dlbGNvbWUiOwppbXBvcnQge3NhdmVHcm91cH0gZnJvbSAnQC9hcGkvZ3JvdXAnCgppbXBvcnQgImthdGV4L2Rpc3Qva2F0ZXgubWluLmNzcyI7CmltcG9ydCAiQC9zdHlsZXMvbGliL3RhaWx3aW5kLmNzcyI7CmltcG9ydCAiQC9zdHlsZXMvbGliL2hpZ2hsaWdodC5zY3NzIjsKaW1wb3J0ICJAL3N0eWxlcy9saWIvZ2l0aHViLW1hcmtkb3duLnNjc3MiOwoKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICJNYWluIiwKICBjb21wb25lbnRzOiB7VGV4dENvbXBvbmVudCwgV2VsY29tZX0sCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIGdyb3VwX2lkOiAwLAogICAgICBsaXN0czogW10sCiAgICAgIG1lc3NhZ2U6ICIiLAogICAgICB3cml0aW5nVGV4dDogIiIsCiAgICAgIHdyaXRpbmc6IGZhbHNlLAogICAgICBwYWdlOiAxLAogICAgICBwYWdlc2l6ZTogMTAwMCwKICAgIH07CiAgfSwKICBjb21wdXRlZDogewogICAgLi4ubWFwR2V0dGVycyhbCiAgICAgICJhdmF0YXIiLAogICAgICAibmlja25hbWUiLAogICAgICAicGFnZV90aXRsZSIsCiAgICAgICJjb3B5cmlnaHQiLAogICAgICAiY29weXJpZ2h0X2xpbmsiLAogICAgXSksCiAgfSwKICBtZXRob2RzOiB7CiAgICBhc3luYyBzZW5kVGV4dCgpIHsKICAgICAgaWYgKHRoaXMud3JpdGluZykgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKHRoaXMuZ3JvdXBfaWQgPT09IDApIHsKICAgICAgICBhd2FpdCB0aGlzLmNyZWF0ZUdyb3VwKCk7CiAgICAgICAgaWYgKHRoaXMuZ3JvdXBfaWQgPT09IDApIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYgKHRoaXMuZ3JvdXBfaWQgPT09IC0xKSB7CiAgICAgICAgICB0aGlzLmdyb3VwX2lkID0gMAogICAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcign5Yib5bu65Lya6K+d5Ye66ZSZ77yM6K+355m75b2V44CCJyk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICB9CgogICAgICBjb25zdCBtZXNzYWdlID0gdGhpcy50cmltKHRoaXMubWVzc2FnZSk7CiAgICAgIGlmICghbWVzc2FnZSkgewogICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IoIuivt+i+k+WFpeS9oOeahOmXrumimCIpOwogICAgICAgIHRoaXMubWVzc2FnZSA9ICIiOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICB0aGlzLmxpc3RzLnB1c2goewogICAgICAgIHVzZXI6ICLmiJEiLAogICAgICAgIG1lc3NhZ2U6IG1lc3NhZ2UsCiAgICAgIH0pOwogICAgICB0aGlzLm1lc3NhZ2UgPSAiIjsKICAgICAgdGhpcy53cml0aW5nID0gdHJ1ZTsKICAgICAgdGhpcy5zY3JvbGxCb3R0b20oKTsKCiAgICAgIGNvbnN0IGhlYWRlcnMgPSBuZXcgSGVhZGVycygpOwogICAgICBoZWFkZXJzLmFwcGVuZCgiQ29udGVudC1UeXBlIiwgImFwcGxpY2F0aW9uL2pzb24iKTsKICAgICAgaGVhZGVycy5hcHBlbmQoIlgtdG9rZW4iLCBnZXRUb2tlbigpKTsKICAgICAgY29uc3QgdXJsID0gcHJvY2Vzcy5lbnYuVlVFX0FQUF9CQVNFX0FQSSArICIvY2hhdC9zZW5kVGV4dCI7CiAgICAgIGNvbnN0IGRhdGEgPSB7CiAgICAgICAgZ3JvdXBfaWQ6IHRoaXMuZ3JvdXBfaWQsCiAgICAgICAgbWVzc2FnZTogbWVzc2FnZSwKICAgICAgfTsKICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaCh1cmwsIHsKICAgICAgICBtZXRob2Q6ICJQT1NUIiwKICAgICAgICBoZWFkZXJzOiBoZWFkZXJzLAogICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KGRhdGEpLAogICAgICB9KTsKCiAgICAgIGlmICghcmVzcG9uc2Uub2spIHsKICAgICAgICB0aGlzLndyaXRpbmcgPSBmYWxzZTsKICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKHJlc3BvbnNlLnN0YXR1c1RleHQpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBjb25zdCByZWFkZXIgPSByZXNwb25zZS5ib2R5LmdldFJlYWRlcigpOwogICAgICBjb25zdCBkZWNvZGVyID0gbmV3IFRleHREZWNvZGVyKCJ1dGYtOCIpOwogICAgICBsZXQgZG9uZSA9IGZhbHNlOwogICAgICBsZXQgY3VyQWlNc2cgPSAiIjsKICAgICAgd2hpbGUgKCFkb25lKSB7CiAgICAgICAgdGhpcy5zY3JvbGxCb3R0b20oKTsKICAgICAgICBjb25zdCB7dmFsdWUsIGRvbmU6IHJlYWRlckRvbmV9ID0gYXdhaXQgcmVhZGVyLnJlYWQoKTsKICAgICAgICBpZiAodmFsdWUpIHsKICAgICAgICAgIGxldCBjaGFyID0gZGVjb2Rlci5kZWNvZGUodmFsdWUpOwogICAgICAgICAgaWYgKGNoYXIgPT09ICJcbiIgJiYgY3VyQWlNc2cuZW5kc1dpdGgoIlxuIikpIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoY2hhcikgewogICAgICAgICAgICBpZiAoY2hhci5pbmRleE9mKCJbZXJyb3JdIikgIT09IC0xKSB7CiAgICAgICAgICAgICAgdGhpcy53cml0aW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgdGhpcy53cml0aW5nVGV4dCA9ICIiOwogICAgICAgICAgICAgIHRoaXMubGlzdHMucG9wKCk7CiAgICAgICAgICAgICAgY29uc3QgZXJyb3IgPSBjaGFyLnJlcGxhY2UoIltlcnJvcl0iLCAiIik7CiAgICAgICAgICAgICAgaWYgKGVycm9yLmluZGV4T2YoIuivt+eZu+W9lSIpICE9PSAtMSkgewogICAgICAgICAgICAgICAgdGhpcy4kZW1pdCgic2hvd2xvZ2luIik7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcihlcnJvcik7CiAgICAgICAgICAgICAgICB9LCA1MDApOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAoZXJyb3IuaW5kZXhPZigi6K+35YWF5YC8IikgIT09IC0xKSB7CiAgICAgICAgICAgICAgICB0aGlzLiRlbWl0KCJzaG93VXNlckluZm8iKTsKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKGVycm9yKTsKICAgICAgICAgICAgICAgIH0sIDUwMCk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMuJGFsZXJ0KGVycm9yLCAi57O757uf5o+Q56S6Iik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIGNoYXIgPSBjaGFyLnJlcGxhY2VBbGwoIlxuIiwgIjxicj4iKTsKICAgICAgICAgICAgdGhpcy53cml0aW5nID0gdHJ1ZTsKICAgICAgICAgICAgdGhpcy53cml0aW5nVGV4dCArPSBjaGFyOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBkb25lID0gcmVhZGVyRG9uZTsKICAgICAgfQogICAgICBpZiAodGhpcy53cml0aW5nVGV4dCkgewogICAgICAgIHRoaXMubGlzdHMucHVzaCh7CiAgICAgICAgICB1c2VyOiAiQUkiLAogICAgICAgICAgbWVzc2FnZTogdGhpcy53cml0aW5nVGV4dCwKICAgICAgICB9KTsKCiAgICAgICAgc2F2ZUFJTWVzc2FnZSh7CiAgICAgICAgICBncm91cF9pZDogdGhpcy5ncm91cF9pZCwKICAgICAgICAgIG1lc3NhZ2U6IHRoaXMud3JpdGluZ1RleHQKICAgICAgICB9KQogICAgICB9CgogICAgICB0aGlzLndyaXRpbmcgPSBmYWxzZTsKICAgICAgdGhpcy53cml0aW5nVGV4dCA9ICIiOwogICAgICB0aGlzLnNjcm9sbEJvdHRvbSgpOwogICAgfSwKICAgIGFzeW5jIGNyZWF0ZUdyb3VwKCkgewogICAgICB0cnkgewogICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IHNhdmVHcm91cCh7dGl0bGU6ICfmlrDnmoTkvJror50nfSk7CiAgICAgICAgaWYgKCFyZXMuZXJybm8pIHsKICAgICAgICAgIHRoaXMuZ3JvdXBfaWQgPSByZXMuZ3JvdXBfaWQ7CiAgICAgICAgICB0aGlzLiRlbWl0KCdncm91cENyZWF0ZWQnKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcihyZXMubWVzc2FnZSB8fCAn5Yib5bu65Lya6K+d5aSx6LSlJyk7CiAgICAgICAgfQogICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoJ+WIm+W7uuS8muivneWHuumUmTonLCBlcnJvcik7CiAgICAgICAgaWYgKGVycm9yLmVycm5vID09PSA0MDMpIHsKICAgICAgICAgIHRoaXMuZ3JvdXBfaWQgPSAtMTsKICAgICAgICAgIHRoaXMuJGVtaXQoInNob3dsb2dpbiIpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKCfliJvlu7rkvJror53lh7rplJnvvIzor7fnqI3lkI7lho3or5UnKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBzZXRHcm91cElkKGdyb3VwX2lkKSB7CiAgICAgIHRoaXMuZ3JvdXBfaWQgPSBncm91cF9pZDsKICAgICAgdGhpcy5wYWdlID0gMTsKICAgICAgdGhpcy5nZXRIaXN0b3J5TXNnKCk7CiAgICB9LAogICAgZ2V0SGlzdG9yeU1zZygpIHsKICAgICAgZ2V0SGlzdG9yeU1zZyh7CiAgICAgICAgZ3JvdXBfaWQ6IHRoaXMuZ3JvdXBfaWQsCiAgICAgICAgcGFnZTogdGhpcy5wYWdlLAogICAgICAgIHBhZ2VzaXplOiB0aGlzLnBhZ2VzaXplLAogICAgICB9KS50aGVuKChyZXMpID0+IHsKICAgICAgICB0aGlzLmxpc3RzID0gcmVzLmRhdGEubGlzdDsKICAgICAgICB0aGlzLiRuZXh0VGljaygoKSA9PiB7CiAgICAgICAgICB0aGlzLnNjcm9sbEJvdHRvbSgpOwogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0sCiAgICBxdWlja01lc3NhZ2UodGV4dCkgewogICAgICB0aGlzLm1lc3NhZ2UgPSB0ZXh0OwogICAgfSwKICAgIG9uQ29weVN1Y2Nlc3MoKSB7CiAgICAgIHRoaXMuJG1lc3NhZ2Uuc3VjY2Vzcygi5bey5aSN5Yi2Iik7CiAgICB9LAogICAgb25Db3B5RXJyb3IoKSB7CiAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IoIuWkjeWItuWksei0pSIpOwogICAgfSwKICAgIG9uRW50ZXIoZSkgewogICAgICBpZiAoIWUuc2hpZnRLZXkpIHsKICAgICAgICB0aGlzLnNlbmRUZXh0KCk7CiAgICAgIH0KICAgIH0sCiAgICB0cmltKHN0cikgewogICAgICBpZiAoc3RyKSB7CiAgICAgICAgc3RyID0gc3RyLnJlcGxhY2UoLyheXHMqKXwoXHMqJCkvZywgIiIpOwogICAgICB9CiAgICAgIHJldHVybiBzdHI7CiAgICB9LAogICAgdGV4dEZvcm1hdChzdHIpIHsKICAgICAgc3RyID0gdGhpcy50cmltKHN0cik7CiAgICAgIGlmIChzdHIgJiYgdHlwZW9mIHN0ci5yZXBsYWNlQWxsID09ICJmdW5jdGlvbiIpIHsKICAgICAgICBzdHIgPSBzdHIucmVwbGFjZUFsbCgiPGJyPiIsICJcbiIpLnJlcGxhY2VBbGwoIiZuYnNwIiwgIiAiKTsKICAgICAgfQogICAgICByZXR1cm4gc3RyOwogICAgfSwKICAgIHNjcm9sbEJvdHRvbSgpIHsKICAgICAgdGhpcy4kbmV4dFRpY2soKCkgPT4gewogICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IHRoaXMuJHJlZnNbIm1zZ2xpc3QiXS53cmFwOwogICAgICAgIGNvbnRhaW5lci5zY3JvbGxUb3AgPSBjb250YWluZXIuc2Nyb2xsSGVpZ2h0OwogICAgICB9KTsKICAgIH0sCiAgfSwKfTsK"},{"version":3,"sources":["Main.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAwFA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Main.vue","sourceRoot":"src/views/index/components","sourcesContent":["<template>\n  <div class=\"wrapper\">\n    <div v-if=\"lists && lists.length > 0\" class=\"box-msg-list\">\n      <el-scrollbar ref=\"msglist\" wrap-class=\"scrollbar-wrapper\">\n        <div class=\"list\">\n          <div v-for=\"(item, index) in lists\" class=\"row\"\n               :style=\"'background:' + (item.user === 'AI'? '#f7f7f8':'#fff') + ';'\">\n            <div v-if=\"item.user === 'AI'\" class=\"message\">\n              <div class=\"avatar\">\n                <img src=\"/static/img/ai.svg\">\n              </div>\n              <div class=\"text markdown-body\">\n                <textComponent\n                  :text=\"item.message\"\n                ></textComponent>\n                <div>\n                  <span\n                    v-clipboard:copy='textFormat(item.message)'\n                    v-clipboard:success=\"onCopySuccess\"\n                    v-clipboard:error=\"onCopyError\"\n                    class=\"copy text-primary\"\n                  >复制内容</span>\n                </div>\n              </div>\n            </div>\n            <div v-else class=\"message\">\n              <div class=\"avatar\" style=\"background: #ffffff;\">\n                <img :src=\"avatar || '/static/img/avatar.png'\">\n              </div>\n              <!--              <div class=\"text\" v-html=\"item.message\" />-->\n              <div class=\"text markdown-body\">\n                <textComponent\n                  :text=\"item.message\"\n                ></textComponent>\n              </div>\n            </div>\n          </div>\n          <div v-if=\"writing\" style=\"background: #f7f7f8;\">\n            <div class=\"message\">\n              <div class=\"avatar\"><img src=\"/static/img/ai.svg\"></div>\n              <div class=\"text markdown-body\">\n                <!--                  <span v-html=\"writingText\"></span>-->\n                <textComponent\n                  :text=\"writingText\"\n                ></textComponent>\n                <span class=\"cursor\"/>\n              </div>\n            </div>\n          </div>\n        </div>\n      </el-scrollbar>\n    </div>\n\n    <welcome\n      v-else\n      :page-title=\"page_title\"\n      @use=\"quickMessage\"\n    ></welcome>\n\n    <div class=\"box-input\">\n      <div class=\"input\">\n        <el-input\n          v-model=\"message\"\n          placeholder=\"输入你的问题（Shift + Enter = 换行）\"\n          @keyup.enter.native=\"onEnter\"\n          type=\"textarea\"\n          :autosize=\"{ minRows: 1, maxRows: 8}\"\n          maxlength=\"3000\"\n        />\n        <el-button\n          class=\"btn-send\"\n          type=\"default\"\n          :loading=\"writing\"\n          icon=\"el-icon-position\"\n          @click=\"sendText\"\n        />\n      </div>\n      <div class=\"copyright\">\n        <div v-if=\"copyright\">\n          <a v-if=\"copyright_link\" :href=\"copyright_link\" target=\"_blank\">{{ copyright }}</a>\n          <span v-else>{{ copyright }}</span>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport {mapGetters} from \"vuex\";\nimport {getHistoryMsg, saveAIMessage} from \"@/api/chat\";\nimport {getToken, getSiteCode} from \"@/utils/auth\";\nimport TextComponent from \"./Text\";\nimport Welcome from \"./Welcome\";\nimport {saveGroup} from '@/api/group'\n\nimport \"katex/dist/katex.min.css\";\nimport \"@/styles/lib/tailwind.css\";\nimport \"@/styles/lib/highlight.scss\";\nimport \"@/styles/lib/github-markdown.scss\";\n\nexport default {\n  name: \"Main\",\n  components: {TextComponent, Welcome},\n  data() {\n    return {\n      group_id: 0,\n      lists: [],\n      message: \"\",\n      writingText: \"\",\n      writing: false,\n      page: 1,\n      pagesize: 1000,\n    };\n  },\n  computed: {\n    ...mapGetters([\n      \"avatar\",\n      \"nickname\",\n      \"page_title\",\n      \"copyright\",\n      \"copyright_link\",\n    ]),\n  },\n  methods: {\n    async sendText() {\n      if (this.writing) {\n        return;\n      }\n\n      if (this.group_id === 0) {\n        await this.createGroup();\n        if (this.group_id === 0) {\n          return;\n        }\n        if (this.group_id === -1) {\n          this.group_id = 0\n          this.$message.error('创建会话出错，请登录。');\n          return;\n        }\n      }\n\n      const message = this.trim(this.message);\n      if (!message) {\n        this.$message.error(\"请输入你的问题\");\n        this.message = \"\";\n        return;\n      }\n      this.lists.push({\n        user: \"我\",\n        message: message,\n      });\n      this.message = \"\";\n      this.writing = true;\n      this.scrollBottom();\n\n      const headers = new Headers();\n      headers.append(\"Content-Type\", \"application/json\");\n      headers.append(\"X-token\", getToken());\n      const url = process.env.VUE_APP_BASE_API + \"/chat/sendText\";\n      const data = {\n        group_id: this.group_id,\n        message: message,\n      };\n      const response = await fetch(url, {\n        method: \"POST\",\n        headers: headers,\n        body: JSON.stringify(data),\n      });\n\n      if (!response.ok) {\n        this.writing = false;\n        this.$message.error(response.statusText);\n        return;\n      }\n      const reader = response.body.getReader();\n      const decoder = new TextDecoder(\"utf-8\");\n      let done = false;\n      let curAiMsg = \"\";\n      while (!done) {\n        this.scrollBottom();\n        const {value, done: readerDone} = await reader.read();\n        if (value) {\n          let char = decoder.decode(value);\n          if (char === \"\\n\" && curAiMsg.endsWith(\"\\n\")) {\n            continue;\n          }\n          if (char) {\n            if (char.indexOf(\"[error]\") !== -1) {\n              this.writing = false;\n              this.writingText = \"\";\n              this.lists.pop();\n              const error = char.replace(\"[error]\", \"\");\n              if (error.indexOf(\"请登录\") !== -1) {\n                this.$emit(\"showlogin\");\n                setTimeout(() => {\n                  this.$message.error(error);\n                }, 500);\n              } else if (error.indexOf(\"请充值\") !== -1) {\n                this.$emit(\"showUserInfo\");\n                setTimeout(() => {\n                  this.$message.error(error);\n                }, 500);\n              } else {\n                this.$alert(error, \"系统提示\");\n              }\n              break;\n            }\n            // char = char.replaceAll(\"\\n\", \"<br>\");\n            this.writing = true;\n            this.writingText += char;\n          }\n        }\n        done = readerDone;\n      }\n      if (this.writingText) {\n        this.lists.push({\n          user: \"AI\",\n          message: this.writingText,\n        });\n\n        saveAIMessage({\n          group_id: this.group_id,\n          message: this.writingText\n        })\n      }\n\n      this.writing = false;\n      this.writingText = \"\";\n      this.scrollBottom();\n    },\n    async createGroup() {\n      try {\n        const res = await saveGroup({title: '新的会话'});\n        if (!res.errno) {\n          this.group_id = res.group_id;\n          this.$emit('groupCreated');\n        } else {\n          this.$message.error(res.message || '创建会话失败');\n        }\n      } catch (error) {\n        console.error('创建会话出错:', error);\n        if (error.errno === 403) {\n          this.group_id = -1;\n          this.$emit(\"showlogin\");\n        } else {\n          this.$message.error('创建会话出错，请稍后再试');\n        }\n      }\n    },\n    setGroupId(group_id) {\n      this.group_id = group_id;\n      this.page = 1;\n      this.getHistoryMsg();\n    },\n    getHistoryMsg() {\n      getHistoryMsg({\n        group_id: this.group_id,\n        page: this.page,\n        pagesize: this.pagesize,\n      }).then((res) => {\n        this.lists = res.data.list;\n        this.$nextTick(() => {\n          this.scrollBottom();\n        });\n      });\n    },\n    quickMessage(text) {\n      this.message = text;\n    },\n    onCopySuccess() {\n      this.$message.success(\"已复制\");\n    },\n    onCopyError() {\n      this.$message.error(\"复制失败\");\n    },\n    onEnter(e) {\n      if (!e.shiftKey) {\n        this.sendText();\n      }\n    },\n    trim(str) {\n      if (str) {\n        str = str.replace(/(^\\s*)|(\\s*$)/g, \"\");\n      }\n      return str;\n    },\n    textFormat(str) {\n      str = this.trim(str);\n      if (str && typeof str.replaceAll == \"function\") {\n        str = str.replaceAll(\"<br>\", \"\\n\").replaceAll(\"&nbsp\", \" \");\n      }\n      return str;\n    },\n    scrollBottom() {\n      this.$nextTick(() => {\n        const container = this.$refs[\"msglist\"].wrap;\n        container.scrollTop = container.scrollHeight;\n      });\n    },\n  },\n};\n</script>\n<style lang=\"scss\" scoped>\n.app-main {\n  /*50 = navbar  */\n  min-height: calc(100vh - 50px);\n  /*min-height: 100vh;*/\n  width: 100%;\n  position: relative;\n  overflow: hidden;\n  background: #f3f6f9;\n}\n\n.fixed-header + .app-main {\n  padding-top: 50px;\n}\n\n.wrapper {\n  display: flex;\n  flex-direction: column;\n}\n\n.box-msg-list {\n  width: 100%;\n  position: absolute;\n  top: 50px;\n  bottom: 140px;\n  left: 0;\n  right: 0;\n  box-sizing: border-box;\n\n  .el-scrollbar {\n    height: 100%;\n    overflow-x: hidden;\n  }\n}\n\n.list {\n  width: 100%;\n  height: auto;\n\n  .row {\n    width: 100%;\n    border-bottom: 1px solid #ddd;\n  }\n}\n\n.message {\n  width: 90%;\n  margin: 0 auto;\n  display: flex;\n  justify-content: flex-start;\n  padding: 20px 20px;\n  box-sizing: border-box;\n  max-width: 100%;\n\n  &:last-child {\n    border-bottom: 0;\n  }\n\n  .text {\n    color: #343541;\n    line-height: 26px;\n    font-size: 16px;\n    word-break: break-all;\n    padding: 4px 0;\n    overflow: hidden;\n    width: 100%;\n    box-sizing: border-box;\n    display: inline;\n\n    span {\n      display: inline;\n    }\n  }\n\n  .copy {\n    width: 80px;\n    height: 36px;\n    cursor: pointer;\n    font-size: 14px;\n  }\n\n  .avatar {\n    width: 30px;\n    height: 30px;\n    min-width: 30px;\n    background: #F7F7F8;\n    color: #fff;\n    font-size: 14px;\n    border-radius: 4px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    margin-top: 3px;\n    margin-right: 20px;\n    overflow: hidden;\n\n    img {\n      width: 30px;\n      height: 30px;\n    }\n  }\n\n  .cursor {\n    background: #3d3d3d;\n    line-height: 100%;\n    border-left: 0.1em solid transparent;\n    animation: cursor 0.6s infinite;\n    display: inline-block;\n    width: 5px;\n    height: 20px;\n    margin-top: 3px;\n  }\n\n  /* Animation */\n  @keyframes cursor {\n    50% {\n      background: white;\n    }\n  }\n}\n\n.box-input {\n  width: 100%;\n  background: #fff;\n  position: fixed;\n  bottom: 0;\n  left: 0;\n  padding: 2vh 0 0 22vh;\n  box-sizing: border-box;\n  transition: padding-left 0.28s;\n\n  .input {\n    width: 768px;\n    margin: 0 auto;\n    box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);\n    border-radius: 10px;\n    position: relative;\n    max-width: 100%;\n\n    .btn-send {\n      position: absolute;\n      right: 1px;\n      bottom: 1px;\n      border: none;\n      height: 40px;\n    }\n  }\n\n  .copyright {\n    width: 768px;\n    margin: 15px auto 20px auto;\n    font-size: 13px;\n    color: #999;\n    text-align: center;\n    letter-spacing: 1px;\n    max-width: 100%;\n    line-height: 18px;\n  }\n}\n\n.mobile {\n  width: 100% !important;\n\n  .box-input {\n    max-width: 100%;\n    padding-left: 20px;\n    padding-right: 20px;\n  }\n}\n</style>\n\n<style lang=\"scss\">\n.scrollbar-wrapper {\n  height: 100%;\n  overflow-x: hidden;\n}\n\n// fix css style bug in open el-dialog\n.el-popup-parent--hidden {\n  .fixed-header {\n    padding-right: 15px;\n  }\n}\n\n.input .el-textarea__inner {\n  padding: 10px 60px 10px 15px;\n  letter-spacing: 1px;\n}\n</style>\n\n<style lang=\"scss\">\n.markdown-body {\n  display: block;\n  width: 100%;\n  background-color: transparent;\n  font-size: 14px;\n  box-sizing: border-box;\n\n  p {\n    white-space: pre-wrap;\n  }\n\n  ol {\n    list-style-type: decimal;\n  }\n\n  ul {\n    list-style-type: disc;\n  }\n\n  pre code,\n  pre tt {\n    line-height: 1.6;\n    font-size: 16px;\n  }\n\n  .highlight pre,\n  pre {\n    //background-color: #fff;\n    background-color: #edeff2;\n    margin-top: 16px;\n  }\n\n  code.hljs {\n    padding: 0;\n  }\n\n  .code-block {\n    &-wrapper {\n      position: relative;\n      padding-top: 24px;\n    }\n\n    &-header {\n      position: absolute;\n      top: 5px;\n      right: 0;\n      width: 100%;\n      padding: 0 1rem;\n      display: flex;\n      justify-content: flex-end;\n      align-items: center;\n      color: #b3b3b3;\n\n      &__copy {\n        cursor: pointer;\n        margin-left: 0.5rem;\n        user-select: none;\n\n        &:hover {\n          color: #65a665;\n        }\n      }\n    }\n  }\n\n  .code-block-wrapper {\n    display: block;\n    width: 100%;\n  }\n}\n\nhtml.dark {\n  .message-reply {\n    .whitespace-pre-wrap {\n      white-space: pre-wrap;\n      color: var(--n-text-color);\n    }\n  }\n\n  .highlight pre,\n  pre {\n    background-color: #282c34;\n  }\n}\n</style>\n"]}]}